<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reçu de Paiement - {{ payment.receipt }}</title>
    <style>
        @page {
            size: A4;
            margin: 15mm;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            font-size: 10px;
            line-height: 1.4;
            color: #000;
            background: white;
        }
        
        .page-container { 
            width: 180mm; 
            height: 267mm; 
            position: relative; 
            margin: 0 auto;
        }
        
        .receipt { 
            width: 180mm; 
            height: 125mm; 
            border: 2px solid #000; 
            padding: 6mm; 
            position: absolute; 
            left: 0; 
            right: 0; 
            background: #fff; 
        }
        
        .receipt-top { top: 0; }
        .receipt-bottom { bottom: 0; }
        
        /* En-tête avec informations de l'école */
        .header {
            margin-bottom: 2mm;
            border-bottom: 1px solid #000;
            padding-bottom: 2mm;
        }
        
        .school-info { 
            display: flex; 
            justify-content: space-between; 
            align-items: flex-start; 
            font-size: 8px; 
            line-height: 1.3; 
        }
        
        .school-left { flex: 1; text-align: left; }
        .school-center { flex: 1; text-align: center; }
        .school-right { flex: 1; text-align: right; }
        
        .school-name { 
            font-weight: bold; 
            font-size: 9px; 
            margin-bottom: 1mm; 
            text-transform: uppercase; 
        }
        
        .contact-info { font-size: 7px; line-height: 1.2; }
        
        .logo-container { 
            width: 16mm; 
            height: 16mm; 
            margin: 0 auto; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        
        .logo-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        
        .republic-info { font-size: 7px; line-height: 1.2; }
        
        /* Titre du document */
        .document-title { 
            text-align: center; 
            margin: 2mm 0; 
            padding: 1.5mm; 
            border: 1.5px solid #000; 
            background: #f0f0f0; 
        }
        
        .document-title h1 { 
            font-size: 12px; 
            font-weight: bold; 
            text-transform: uppercase; 
            margin: 0; 
        }
        
        /* Informations de l'étudiant */
        .student-info {
            margin-bottom: 2mm;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5mm;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1mm 0;
            border-bottom: 0.5px solid #ccc;
            min-height: 4mm;
        }
        
        .info-row:last-child {
            border-bottom: none;
        }
        
        .label {
            font-weight: bold;
            font-size: 8px;
            flex: 1;
        }
        
        .value {
            font-weight: normal;
            font-size: 8px;
            text-align: right;
            flex: 1;
            padding-left: 2mm;
        }
        
        /* Section paiement et statut */
        .payment-section {
            display: flex;
            justify-content: space-between;
            align-items: stretch;
            margin-bottom: 2mm;
            gap: 2mm;
        }
        
        .status-box {
            flex: 1;
            border: 1px solid #000;
            padding: 2mm;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .status-text {
            font-size: 9px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .payment-box {
            flex: 2;
            border: 1px solid #000;
            padding: 2mm;
            text-align: center;
        }
        
        .payment-title {
            font-size: 8px;
            font-weight: bold;
            margin-bottom: 1mm;
            text-transform: uppercase;
        }
        
        .payment-amount { 
            font-size: 14px; 
            font-weight: bold; 
            margin-bottom: 1mm; 
        }
        
        .qr-code-box { 
            width: 16mm; 
            height: 16mm; 
            border: 1px solid #000; 
            margin: 0 auto; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        
        .signature-box {
            flex: 1;
            border: 1px solid #000;
            padding: 2mm;
            text-align: center;
        }
        
        .signature-text {
            font-size: 7px;
            font-weight: bold;
            text-align: center;
            line-height: 1.2;
            margin-bottom: 2mm;
        }
        
        .stamp-area {
            width: 20mm;
            height: 20mm;
            border: 1px dashed #999;
            border-radius: 50%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4px;
            color: #999;
            text-align: center;
            line-height: 1.1;
        }
        
        /* Pied de page */
        .footer {
            position: absolute;
            bottom: 3mm;
            left: 3mm;
            right: 3mm;
            font-size: 6px;
            line-height: 1.2;
        }
        
        .footer-info {
            text-align: right;
            margin-bottom: 1.5mm;
        }
        
        .mission-text {
            font-size: 5px;
            line-height: 1.3;
            text-align: justify;
            border-top: 0.5px solid #ccc;
            padding-top: 1mm;
        }
        
        /* Responsive pour l'aperçu */
        @media screen { 
            .page-container { 
                max-width: 180mm; 
                margin: 20px auto; 
                box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            } 
        }
        
        /* Styles pour l'impression */
        @media print {
            .page-container {
                page-break-after: always;
            }
        }
    </style>
</head>
<body>
    <div class="page-container">
        <!-- Reçu 1 (haut) -->
        <div class="receipt receipt-top">
            <!-- En-tête -->
            <div class="header">
                <div class="school-info">
                    <div class="school-left">
                        <div class="school-name">
                            {% if school %}{{ school.name|upper }}{% else %}ÉTABLISSEMENT SCOLAIRE{% endif %}
                        </div>
                        <div class="contact-info">
                            {% if school.authorization_number %}N° d'autorisation: {{ school.authorization_number }}{% endif %}
                            {% if school.phone %}<br>Tél: {{ school.phone }}{% endif %}
                            {% if school.email %}<br>Email: {{ school.email }}{% endif %}
                            {% if school.website %}<br>Site Web: {{ school.website }}{% endif %}
                            {% if document_header and document_header.school_motto %}<br><em>{{ document_header.school_motto }}</em>{% endif %}
                        </div>
                    </div>
                    
                    <div class="school-center">
                        <div class="logo-container">
                            {% if logo_url %}
                                <img src="{{ logo_url }}" alt="Logo" class="logo-image"/>
                            {% else %}
                                <div style="width: 16mm; height: 16mm; border: 1px solid #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 4px; font-weight: bold; text-align: center; line-height: 1.1;">
                                    {% if school %}{{ school.name|slice:":20" }}{% else %}LOGO{% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="school-right">
                        <div class="republic-info">
                            REPUBLIQUE DU CAMEROUN<br>
                            Paix - Travail - Patrie<br><br>
                            {% if document_header and document_header.ministry %}
                                {{ document_header.ministry.name|upper }}<br>
                                {% if document_header.regional_delegation %}
                                    {{ document_header.regional_delegation.name }}
                                {% endif %}
                            {% else %}
                                MINISTERE DES ENSEIGNEMENTS<br>
                                SECONDAIRE
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Titre du document -->
            <div class="document-title">
                <h1>
                    {% if payment_type == 'inscription' %}
                        RECU D'INSCRIPTION
                    {% else %}
                        RECU DE PAIEMENT
                    {% endif %}
                </h1>
            </div>
            
            <!-- Informations de l'étudiant -->
            <div class="student-info">
                <div class="info-grid">
                    <div class="info-row">
                        <span class="label">Code inscription:</span>
                        <span class="value">{{ payment.receipt }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Matricule étudiant:</span>
                        <span class="value">{{ payment.student.matricule|default:"N/A" }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Nom(s) et prénom(s):</span>
                        <span class="value">{{ payment.student.last_name.upper }} {{ payment.student.first_name }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Sexe:</span>
                        <span class="value">{{ payment.student.gender|default:"N/A" }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Nationalité:</span>
                        <span class="value">{{ payment.student.nationality|default:"CAMEROUNAISE" }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Classe:</span>
                        <span class="value">
                            {% if payment_type == 'inscription' %}
                                {{ payment.fee_structure.school_class.name }}
                            {% else %}
                                {{ payment.tranche.fee_structure.school_class.name }}
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Niveau:</span>
                        <span class="value">
                            {% if payment_type == 'inscription' %}
                                {{ payment.fee_structure.school_class.level.name }}
                            {% else %}
                                {{ payment.tranche.fee_structure.school_class.level.name }}
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Date inscription:</span>
                        <span class="value">{{ payment.payment_date|date:"d/m/Y" }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Section paiement et statut -->
            <div class="payment-section">
                <div class="status-box">
                    <div class="status-text">STATUT<br>REGULIER</div>
                </div>
                
                <div class="payment-box">
                    <div class="payment-title">
                        {% if payment_type == 'inscription' %}
                            Frais d'inscription
                        {% else %}
                            Montant payé
                        {% endif %}
                    </div>
                    <div class="payment-amount">{{ payment.amount|floatformat:0 }}</div>
                    <div class="qr-code-box">
                        {% if qr_data_url %}
                            <img src="{{ qr_data_url }}" alt="QR" style="width: 100%; height: 100%; object-fit: contain;"/>
                        {% else %}
                            <span style="font-size:3px; text-align:center">QR-CODE</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="signature-box">
                    <div class="signature-text">
                        {% if document_header and document_header.director_title %}
                            {{ document_header.director_title }}
                        {% else %}
                            Cachet et signature du Comptable
                        {% endif %}
                    </div>
                    <div class="stamp-area">
                        {% if signature_url %}
                            <img src="{{ signature_url }}" alt="Signature" style="width: 100%; height: 100%; object-fit: contain;"/>
                        {% else %}
                            Espace pour<br>cachet et<br>signature
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Pied de page -->
            <div class="footer">
                <div class="footer-info">
                    <strong>Édité par:</strong> 
                    {% if document_header and document_header.director_name %}
                        {{ document_header.director_name }}
                    {% else %}
                        DIRECTEUR
                    {% endif %} | 
                    <strong>Année académique:</strong> 
                    {% if payment_type == 'inscription' %}
                        {{ payment.fee_structure.year.annee }}
                    {% else %}
                        {{ payment.tranche.fee_structure.year.annee }}
                    {% endif %} | 
                    <strong>Imprimé le:</strong> {{ payment.created_at|date:"d/m/Y H:i:s" }}
                </div>
                
                <div class="mission-text">
                    {% if document_header and document_header.school_motto %}
                        {{ document_header.school_motto }}
                    {% else %}
                        Notre mission est de former des élèves responsables et compétents en leur offrant un enseignement de qualité dans les filières générales, techniques et professionnelles. Nous adaptons nos méthodes pédagogiques aux besoins des apprenants, favorisons l'esprit d'initiative et préparons les jeunes à poursuivre des études supérieures ou à s'insérer dans le monde professionnel.
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Reçu 2 (bas) -->
        <div class="receipt receipt-bottom">
            <!-- En-tête -->
            <div class="header">
                <div class="school-info">
                    <div class="school-left">
                        <div class="school-name">
                            {% if school %}{{ school.name|upper }}{% else %}ÉTABLISSEMENT SCOLAIRE{% endif %}
                        </div>
                        <div class="contact-info">
                            {% if school.authorization_number %}N° d'autorisation: {{ school.authorization_number }}{% endif %}
                            {% if school.phone %}<br>Tél: {{ school.phone }}{% endif %}
                            {% if school.email %}<br>Email: {{ school.email }}{% endif %}
                            {% if school.website %}<br>Site Web: {{ school.website }}{% endif %}
                            {% if document_header and document_header.school_motto %}<br><em>{{ document_header.school_motto }}</em>{% endif %}
                        </div>
                    </div>
                    
                    <div class="school-center">
                        <div class="logo-container">
                            {% if logo_url %}
                                <img src="{{ logo_url }}" alt="Logo" class="logo-image"/>
                            {% else %}
                                <div style="width: 16mm; height: 16mm; border: 1px solid #000; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 4px; font-weight: bold; text-align: center; line-height: 1.1;">
                                    {% if school %}{{ school.name|slice:":20" }}{% else %}LOGO{% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="school-right">
                        <div class="republic-info">
                            REPUBLIQUE DU CAMEROUN<br>
                            Paix - Travail - Patrie<br><br>
                            {% if document_header and document_header.ministry %}
                                {{ document_header.ministry.name|upper }}<br>
                                {% if document_header.regional_delegation %}
                                    {{ document_header.regional_delegation.name }}
                                {% endif %}
                            {% else %}
                                MINISTERE DES ENSEIGNEMENTS<br>
                                SECONDAIRE
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Titre du document -->
            <div class="document-title">
                <h1>
                    {% if payment_type == 'inscription' %}
                        RECU D'INSCRIPTION
                    {% else %}
                        RECU DE PAIEMENT
                    {% endif %}
                </h1>
            </div>
            
            <!-- Informations de l'étudiant -->
            <div class="student-info">
                <div class="info-grid">
                    <div class="info-row">
                        <span class="label">Code inscription:</span>
                        <span class="value">{{ payment.receipt }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Matricule étudiant:</span>
                        <span class="value">{{ payment.student.matricule|default:"N/A" }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Nom(s) et prénom(s):</span>
                        <span class="value">{{ payment.student.last_name.upper }} {{ payment.student.first_name }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Sexe:</span>
                        <span class="value">{{ payment.student.gender|default:"N/A" }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Nationalité:</span>
                        <span class="value">{{ payment.student.nationality|default:"CAMEROUNAISE" }}</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Classe:</span>
                        <span class="value">
                            {% if payment_type == 'inscription' %}
                                {{ payment.fee_structure.school_class.name }}
                            {% else %}
                                {{ payment.tranche.fee_structure.school_class.name }}
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Niveau:</span>
                        <span class="value">
                            {% if payment_type == 'inscription' %}
                                {{ payment.fee_structure.school_class.level.name }}
                            {% else %}
                                {{ payment.tranche.fee_structure.school_class.level.name }}
                            {% endif %}
                        </span>
                    </div>
                    <div class="info-row">
                        <span class="label">Date inscription:</span>
                        <span class="value">{{ payment.payment_date|date:"d/m/Y" }}</span>
                    </div>
                </div>
            </div>
            
            <!-- Section paiement et statut -->
            <div class="payment-section">
                <div class="status-box">
                    <div class="status-text">STATUT<br>REGULIER</div>
                </div>
                
                <div class="payment-box">
                    <div class="payment-title">
                        {% if payment_type == 'inscription' %}
                            Frais d'inscription
                        {% else %}
                            Montant payé
                        {% endif %}
                    </div>
                    <div class="payment-amount">{{ payment.amount|floatformat:0 }}</div>
                    <div class="qr-code-box">
                        {% if qr_data_url %}
                            <img src="{{ qr_data_url }}" alt="QR" style="width: 100%; height: 100%; object-fit: contain;"/>
                        {% else %}
                            <span style="font-size:3px; text-align:center">QR-CODE</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="signature-box">
                    <div class="signature-text">
                        {% if document_header and document_header.director_title %}
                            {{ document_header.director_title }}
                        {% else %}
                            Cachet et signature du Comptable
                        {% endif %}
                    </div>
                    <div class="stamp-area">
                        {% if signature_url %}
                            <img src="{{ signature_url }}" alt="Signature" style="width: 100%; height: 100%; object-fit: contain;"/>
                        {% else %}
                            Espace pour<br>cachet et<br>signature
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Pied de page -->
            <div class="footer">
                <div class="footer-info">
                    <strong>Édité par:</strong> 
                    {% if document_header and document_header.director_name %}
                        {{ document_header.director_name }}
                    {% else %}
                        DIRECTEUR
                    {% endif %} | 
                    <strong>Année académique:</strong> 
                    {% if payment_type == 'inscription' %}
                        {{ payment.fee_structure.year.annee }}
                    {% else %}
                        {{ payment.tranche.fee_structure.year.annee }}
                    {% endif %} | 
                    <strong>Imprimé le:</strong> {{ payment.created_at|date:"d/m/Y H:i:s" }}
                </div>
                
                <div class="mission-text">
                    {% if document_header and document_header.school_motto %}
                        {{ document_header.school_motto }}
                    {% else %}
                        Notre mission est de former des élèves responsables et compétents en leur offrant un enseignement de qualité dans les filières générales, techniques et professionnelles. Nous adaptons nos méthodes pédagogiques aux besoins des apprenants, favorisons l'esprit d'initiative et préparons les jeunes à poursuivre des études supérieures ou à s'insérer dans le monde professionnel.
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>
</html> 