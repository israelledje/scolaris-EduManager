{% load widget_tweaks %}
<div>
    <div class="mb-4">
        <div class="text-lg font-bold text-slate-900 flex items-center gap-2">
            <i class="fas fa-trash text-red-600"></i>
            Confirmer la suppression
        </div>
        <div class="text-slate-500 text-sm mt-1">
            Êtes-vous sûr de vouloir supprimer l'affectation de <strong>{{ assignment.subject.name }}</strong> 
            dans <strong>{{ assignment.school_class.name }}</strong> ?
        </div>
    </div>
    
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
        <div class="flex items-start gap-3">
            <i class="fas fa-exclamation-triangle text-red-600 mt-1"></i>
            <div>
                <h4 class="text-red-800 font-medium">Attention !</h4>
                <p class="text-red-700 text-sm mt-1">
                    Cette action est irréversible. Toutes les données associées à cette affectation 
                    (coefficients, heures, notes, etc.) seront également supprimées.
                </p>
            </div>
        </div>
    </div>
    
    <form method="post" class="space-y-6" id="teaching-assignment-delete-form">
        {% csrf_token %}
        
        <div class="flex items-center justify-end gap-3 pt-4 border-t border-slate-100 mt-6">
            <button type="button" onclick="closeAssignmentModal()" class="px-4 py-2 text-slate-700 hover:bg-slate-200 rounded-xl transition-colors duration-200">Annuler</button>
            <button type="submit" class="px-6 py-2 bg-gradient-to-r from-red-600 to-pink-600 text-white rounded-xl hover:from-red-700 hover:to-pink-700 transition-all duration-200 shadow-lg hover:shadow-xl flex items-center">
                <span class="btn-text">Supprimer définitivement</span>
                <i class="fas fa-spinner fa-spin hidden loading-spinner ml-2"></i>
            </button>
        </div>
    </form>
</div>

<script>
// Gestion de la soumission du formulaire de suppression
document.getElementById('teaching-assignment-delete-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const form = this;
    const submitBtn = form.querySelector('button[type="submit"]');
    const btnText = submitBtn.querySelector('.btn-text');
    const spinner = submitBtn.querySelector('.loading-spinner');
    
    // Afficher le spinner
    btnText.textContent = 'Suppression...';
    spinner.classList.remove('hidden');
    submitBtn.disabled = true;
    
    // Récupérer les données du formulaire
    const formData = new FormData(form);
    
    // Soumettre via fetch
    fetch(window.location.pathname, {
        method: 'POST',
        body: formData,
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => {
        if (response.status === 204) {
            // Succès - fermer la modale et recharger la page
            closeAssignmentModal();
            window.location.reload();
        } else {
            // Erreur - afficher le message
            return response.text();
        }
    })
    .then(html => {
        if (html) {
            // Afficher les erreurs
            alert('Erreur lors de la suppression');
        }
    })
    .catch(error => {
        console.error('Erreur:', error);
        alert('Erreur lors de la suppression');
    })
    .finally(() => {
        // Restaurer le bouton
        btnText.textContent = 'Supprimer définitivement';
        spinner.classList.add('hidden');
        submitBtn.disabled = false;
    });
});
</script>
