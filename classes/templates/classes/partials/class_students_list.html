{% comment %} Liste des élèves de la classe - vue switchable (kanban/tableau) {% endcomment %}
<div class="flex items-center justify-end gap-2 mb-4">
    <button id="btn-students-grid-view" type="button" class="px-3 py-1.5 rounded-lg text-sm font-medium border border-slate-200 bg-white shadow-sm text-slate-900 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-blue-200 transition">
        <i class="fas fa-th-large"></i> Cartes
    </button>
    <button id="btn-students-table-view" type="button" class="px-3 py-1.5 rounded-lg text-sm font-medium border border-slate-200 text-slate-500 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-blue-200 transition">
        <i class="fas fa-table"></i> Tableau
    </button>
    <a href="{% url 'classes:export_students_excel' schoolclass.id %}" target="_blank" class="px-3 py-1.5 rounded-lg text-sm font-medium border border-slate-200 text-green-700 bg-green-50 hover:bg-green-100 flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-green-200 transition">
        <i class="fas fa-file-excel"></i> Exporter
    </a>
</div>

{% with students=schoolclass.students.all %}
    {% if students %}
        <!-- Vue Kanban (cartes) -->
        <ul id="students-grid-view" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {% for student in students %}
                <li class="flex items-center bg-white rounded-xl shadow p-4 border border-slate-100 hover:shadow-lg transition">
                    <div class="w-14 h-14 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center mr-4">
                        {% if student.photo %}
                            <img src="{{ student.photo.url }}" alt="{{ student.first_name }} {{ student.last_name }}" class="object-cover w-full h-full">
                        {% else %}
                            <i class="fas fa-user-graduate text-slate-400 text-2xl"></i>
                        {% endif %}
                    </div>
                    <div class="flex-1">
                        <div class="font-semibold text-slate-900">{{ student.first_name }} {{ student.last_name }}</div>
                        <div class="text-xs text-slate-500">Matricule : {{ student.matricule }}</div>
                        <div class="text-xs text-slate-500">Sexe : {{ student.get_gender_display }}</div>
                        <div class="text-xs">
                            {% if student.is_active %}
                                <span class="inline-block px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs">Actif</span>
                            {% else %}
                                <span class="inline-block px-2 py-0.5 bg-red-100 text-red-700 rounded-full text-xs">Inactif</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="flex flex-col gap-2 ml-4">
                        <a href="{% url 'students:student_detail' student.id %}" class="text-blue-600 hover:underline text-xs">Voir</a>
                    </div>
                </li>
            {% endfor %}
        </ul>
        <!-- Vue Tableau -->
        <div id="students-table-view" class="overflow-x-auto" style="display: none;">
            <table class="min-w-full divide-y divide-slate-200 rounded-xl overflow-hidden bg-white shadow">
                <thead class="bg-slate-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Photo</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Nom</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Matricule</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Sexe</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Statut</th>
                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-100">
                    {% for student in students %}
                    <tr class="hover:bg-slate-50 transition">
                        <td class="px-4 py-2">
                            <div class="w-10 h-10 rounded-full overflow-hidden bg-slate-100 flex items-center justify-center">
                                {% if student.photo %}
                                    <img src="{{ student.photo.url }}" alt="{{ student.first_name }} {{ student.last_name }}" class="object-cover w-full h-full">
                                {% else %}
                                    <i class="fas fa-user-graduate text-slate-400 text-lg"></i>
                                {% endif %}
                            </div>
                        </td>
                        <td class="px-4 py-2 font-medium text-slate-900">{{ student.first_name }} {{ student.last_name }}</td>
                        <td class="px-4 py-2 text-slate-700">{{ student.matricule }}</td>
                        <td class="px-4 py-2 text-slate-700">{{ student.get_gender_display }}</td>
                        <td class="px-4 py-2">
                            {% if student.is_active %}
                                <span class="inline-block px-2 py-0.5 bg-emerald-100 text-emerald-700 rounded-full text-xs">Actif</span>
                            {% else %}
                                <span class="inline-block px-2 py-0.5 bg-red-100 text-red-700 rounded-full text-xs">Inactif</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-2">
                            <a href="{% url 'students:student_detail' student.id %}" class="text-blue-600 hover:underline text-xs">Voir</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-gray-500 text-center py-4">Aucun élève inscrit dans cette classe.</div>
    {% endif %}
{% endwith %}
<script>
// Switch grid/table view pour la liste des élèves
(function() {
    const gridBtn = document.getElementById('btn-students-grid-view');
    const tableBtn = document.getElementById('btn-students-table-view');
    const gridView = document.getElementById('students-grid-view');
    const tableView = document.getElementById('students-table-view');
    if (gridBtn && tableBtn && gridView && tableView) {
        gridBtn.addEventListener('click', function () {
            gridView.style.display = '';
            tableView.style.display = 'none';
            gridBtn.classList.add('bg-white', 'shadow-sm', 'text-slate-900');
            gridBtn.classList.remove('text-slate-500');
            tableBtn.classList.remove('bg-white', 'shadow-sm', 'text-slate-900');
            tableBtn.classList.add('text-slate-500');
        });
        tableBtn.addEventListener('click', function () {
            gridView.style.display = 'none';
            tableView.style.display = '';
            tableBtn.classList.add('bg-white', 'shadow-sm', 'text-slate-900');
            tableBtn.classList.remove('text-slate-500');
            gridBtn.classList.remove('bg-white', 'shadow-sm', 'text-slate-900');
            gridBtn.classList.add('text-slate-500');
        });
        // Par défaut : grid visible, table cachée
        gridView.style.display = '';
        tableView.style.display = 'none';
        gridBtn.classList.add('bg-white', 'shadow-sm', 'text-slate-900');
        gridBtn.classList.remove('text-slate-500');
        tableBtn.classList.remove('bg-white', 'shadow-sm', 'text-slate-900');
        tableBtn.classList.add('text-slate-500');
    }
})();
</script>